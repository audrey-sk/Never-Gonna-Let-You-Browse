<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>NeverGonnaLetYouBrowse</title>
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
</head>

<body>
    <div class="container">
        <div class="header">
            <img src="rick-logo.jpg" alt="Rick Roll" class="logo">
            <h1 class="pixel-text">Never Gonna</h1>
        </div>
        <button id="toggleButton" class="toggle-btn pixel-text">ACTIVATE</button>
        <div id="status" class="status"></div>
    </div>
</body>

<style>
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    width: 200px;
    height: 180px;
    background: #160E0C;
    color: #D7D8D2;
    font-family: "Press Start 2P", cursive;
}

.container {
    padding: 16px;
    display: flex;
    flex-direction: column;
    gap: 16px;
    align-items: center;
}

.header {
    display: flex;
    align-items: center;
    gap: 12px;
}

.logo {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    object-fit: cover;
}

h1 {
    font-size: 12px;
}

.toggle-btn {
    background: #A2342B;
    color: #D7D8D2;
    border: none;
    padding: 12px 24px;
    border-radius: 4px;
    cursor: pointer;
    font-family: "Press Start 2P", cursive;
    font-size: 12px;
    transition: all 0.3s ease;
}

.toggle-btn:hover {
    opacity: 0.9;
}

.toggle-btn.active {
    background: #2BA234;
}

.status {
    font-size: 9px;
    text-align: center;
    height: 20px;
    color: #A2342B;
}

.blink {
    animation: blink 1s infinite;
}

@keyframes blink {
    0% { opacity: 1; }
    50% { opacity: 0.3; }
    100% { opacity: 1; }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const toggleButton = document.getElementById('toggleButton');
    const statusEl = document.getElementById('status');
    
    // Load initial state
    chrome.storage.local.get(['isActive'], function(result) {
        updateUI(result.isActive);
    });

    // Toggle functionality
    toggleButton.addEventListener('click', function() {
        // Disable button during transition
        toggleButton.disabled = true;
        
        const isActive = !toggleButton.classList.contains('active');
        updateUI(isActive);
        
        // Show status message
        statusEl.textContent = isActive ? 'Activating...' : 'Deactivating...';
        statusEl.classList.add('blink');
        
        // Send message to background script
        chrome.runtime.sendMessage({
            action: "setState",
            isActive: isActive
        }, function(response) {
            if (response && response.success) {
                // Update status
                statusEl.textContent = isActive ? 'ACTIVATED! Reloading...' : 'DEACTIVATED! Reloading...';
                
                // Reload current tab to apply changes
                chrome.tabs.query({active: true, currentWindow: true}, function(tabs) {
                    if (tabs[0]) {
                        chrome.tabs.reload(tabs[0].id);
                    }
                    // Re-enable button after a short delay
                    setTimeout(() => {
                        toggleButton.disabled = false;
                        statusEl.classList.remove('blink');
                        // Clear status after a moment
                        setTimeout(() => {
                            statusEl.textContent = '';
                        }, 1500);
                    }, 500);
                });
            } else {
                // Error case
                statusEl.textContent = 'Error! Try again';
                toggleButton.disabled = false;
                statusEl.classList.remove('blink');
            }
        });
    });
    
    function updateUI(isActive) {
        if (isActive) {
            toggleButton.classList.add('active');
            toggleButton.textContent = 'DEACTIVATE';
        } else {
            toggleButton.classList.remove('active');
            toggleButton.textContent = 'ACTIVATE';
        }
    }
});
</script>